<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Redis入门 | raptor's blog</title><meta name="description" content="Redis的集群：Redis分片的缺点、集群架构、集群操作基本命令。Lua脚本语言的介绍。Redis和Lua结合，Redis的Lua脚本编程，构建强大的Redis服务。Redis整合Spring等。Redis集群实现Tomcat集群的Session共享等"><meta name="keywords" content="Redis"><meta name="author" content="陳 ？"><meta name="copyright" content="陳 ？"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Redis入门"><meta name="twitter:description" content="Redis的集群：Redis分片的缺点、集群架构、集群操作基本命令。Lua脚本语言的介绍。Redis和Lua结合，Redis的Lua脚本编程，构建强大的Redis服务。Redis整合Spring等。Redis集群实现Tomcat集群的Session共享等"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210401142628.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Redis入门"><meta property="og:url" content="http://raptor1998.top/2021/03/27/redis/"><meta property="og:site_name" content="raptor's blog"><meta property="og:description" content="Redis的集群：Redis分片的缺点、集群架构、集群操作基本命令。Lua脚本语言的介绍。Redis和Lua结合，Redis的Lua脚本编程，构建强大的Redis服务。Redis整合Spring等。Redis集群实现Tomcat集群的Session共享等"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210401142628.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://raptor1998.top/2021/03/27/redis/"><link rel="prev" title="MySQL优化" href="http://raptor1998.top/2021/04/06/mysql%E4%BC%98%E5%8C%96/"><link rel="next" title="mybatis" href="http://raptor1998.top/2021/03/10/mybatis/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0b50707a55dfca710ef66e4071fa22cb";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://raptor1998.top/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: {"text":"高大威猛,英俊潇洒,智勇双全,器宇不凡,风流倜傥,玉树临风,成熟稳重,风趣幽默,举世无双,绝无仅有,空前绝后,独一无二,前无古人,后无来者,只此一家,别无分店","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-center"},
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="raptor's blog" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">raptor's blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 日常</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> MV</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/20200102090650.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 日常</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> MV</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#概述"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">概述</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#NoSql？非关系型数据库"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">NoSql？非关系型数据库</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#单机MySQL"><span class="toc_mobile_items-number">1.1.1.</span> <span class="toc_mobile_items-text">单机MySQL</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Memcached-缓存-MySQL-垂直拆分"><span class="toc_mobile_items-number">1.1.2.</span> <span class="toc_mobile_items-text">Memcached(缓存)+MySQL+垂直拆分</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#分表分库-水平拆分-mysql集群"><span class="toc_mobile_items-number">1.1.3.</span> <span class="toc_mobile_items-text">分表分库+水平拆分+mysql集群</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#NoSql特点"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">NoSql特点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#NoSql数据库分类"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">NoSql数据库分类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#分布式数据库CAP"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">分布式数据库CAP</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#ACID"><span class="toc_mobile_items-number">1.4.1.</span> <span class="toc_mobile_items-text">ACID</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#CAP"><span class="toc_mobile_items-number">1.4.2.</span> <span class="toc_mobile_items-text">CAP</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#CAP的三进二"><span class="toc_mobile_items-number">1.4.3.</span> <span class="toc_mobile_items-text">CAP的三进二</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#BASE"><span class="toc_mobile_items-number">1.4.4.</span> <span class="toc_mobile_items-text">BASE</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Redis简介"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">Redis简介</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Redis文档"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">Redis文档</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Redis-与其他-key-value-缓存产品有以下三个特点："><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">Redis 与其他 key - value 缓存产品有以下三个特点：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#安装"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">安装</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#xxxx"><span class="toc_mobile_items-number">2.3.0.1.</span> <span class="toc_mobile_items-text">xxxx</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Redis配置文件"><span class="toc_mobile_items-number">2.3.1.</span> <span class="toc_mobile_items-text">Redis配置文件</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#基础命令"><span class="toc_mobile_items-number">2.3.1.1.</span> <span class="toc_mobile_items-text">基础命令</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Redis数据类型"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Redis数据类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#键key"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">键key</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#String"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">String</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Hash"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">Hash</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#List"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">List</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Set"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">Set</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#有序表Zset"><span class="toc_mobile_items-number">3.6.</span> <span class="toc_mobile_items-text">有序表Zset</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#命令"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">命令</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#配置文件解析"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">配置文件解析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#内存处理策略"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">内存处理策略</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Redis的持久化"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">Redis的持久化</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#简介"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Fork"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">Fork</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#RDB保存的是dump-rdb文件"><span class="toc_mobile_items-number">7.3.</span> <span class="toc_mobile_items-text">RDB保存的是dump.rdb文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#RDB-（redis-database）"><span class="toc_mobile_items-number">7.4.</span> <span class="toc_mobile_items-text">RDB （redis database）</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#数据恢复"><span class="toc_mobile_items-number">7.4.1.</span> <span class="toc_mobile_items-text">数据恢复</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#优势"><span class="toc_mobile_items-number">7.4.2.</span> <span class="toc_mobile_items-text">优势</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#劣势"><span class="toc_mobile_items-number">7.4.3.</span> <span class="toc_mobile_items-text">劣势</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#AOF-（Append-Only-File）"><span class="toc_mobile_items-number">7.5.</span> <span class="toc_mobile_items-text">AOF （Append Only File）</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#配置"><span class="toc_mobile_items-number">7.5.1.</span> <span class="toc_mobile_items-text">配置</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#appendonly-yes-开启"><span class="toc_mobile_items-number">7.5.1.0.1.</span> <span class="toc_mobile_items-text">appendonly yes  开启</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#appendfsync-everysec"><span class="toc_mobile_items-number">7.5.1.0.2.</span> <span class="toc_mobile_items-text">appendfsync everysec</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#no-appendfsync-on-rewrite-no"><span class="toc_mobile_items-number">7.5.1.0.3.</span> <span class="toc_mobile_items-text">no-appendfsync-on-rewrite no</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#auto-aof-rewrite-percentage-100"><span class="toc_mobile_items-number">7.5.1.0.4.</span> <span class="toc_mobile_items-text">auto-aof-rewrite-percentage 100</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#auto-aof-rewrite-min-size-64mb"><span class="toc_mobile_items-number">7.5.1.0.5.</span> <span class="toc_mobile_items-text">auto-aof-rewrite-min-size 64mb</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#修复"><span class="toc_mobile_items-number">7.5.2.</span> <span class="toc_mobile_items-text">修复</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#正常恢复"><span class="toc_mobile_items-number">7.5.2.1.</span> <span class="toc_mobile_items-text">正常恢复</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#异常"><span class="toc_mobile_items-number">7.5.2.2.</span> <span class="toc_mobile_items-text">异常</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Rewrite"><span class="toc_mobile_items-number">7.5.3.</span> <span class="toc_mobile_items-text">Rewrite</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#重写原理"><span class="toc_mobile_items-number">7.5.3.1.</span> <span class="toc_mobile_items-text">重写原理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#触发"><span class="toc_mobile_items-number">7.5.3.2.</span> <span class="toc_mobile_items-text">触发</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#劣势-1"><span class="toc_mobile_items-number">7.5.4.</span> <span class="toc_mobile_items-text">劣势</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#如何选择"><span class="toc_mobile_items-number">7.6.</span> <span class="toc_mobile_items-text">如何选择</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Redis事务"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">Redis事务</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#demo"><span class="toc_mobile_items-number">8.0.1.</span> <span class="toc_mobile_items-text">demo</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#watch监控"><span class="toc_mobile_items-number">8.0.2.</span> <span class="toc_mobile_items-text">watch监控</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#悲观锁-Pessimistic-Lock"><span class="toc_mobile_items-number">8.0.2.1.</span> <span class="toc_mobile_items-text">悲观锁  Pessimistic Lock</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#乐观锁"><span class="toc_mobile_items-number">8.0.2.2.</span> <span class="toc_mobile_items-text">乐观锁</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#demo-1"><span class="toc_mobile_items-number">8.0.2.3.</span> <span class="toc_mobile_items-text">demo</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#事务三特性"><span class="toc_mobile_items-number">8.0.3.</span> <span class="toc_mobile_items-text">事务三特性</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Redis的发布订阅"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">Redis的发布订阅</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#主从复制-master-salve"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text">主从复制  master&#x2F;salve</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#如何操作"><span class="toc_mobile_items-number">10.1.</span> <span class="toc_mobile_items-text">如何操作</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#复制"><span class="toc_mobile_items-number">10.2.</span> <span class="toc_mobile_items-text">复制</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#哨兵模式"><span class="toc_mobile_items-number">10.3.</span> <span class="toc_mobile_items-text">哨兵模式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#缺点"><span class="toc_mobile_items-number">10.3.1.</span> <span class="toc_mobile_items-text">缺点</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#概述"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSql？非关系型数据库"><span class="toc-number">1.1.</span> <span class="toc-text">NoSql？非关系型数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单机MySQL"><span class="toc-number">1.1.1.</span> <span class="toc-text">单机MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memcached-缓存-MySQL-垂直拆分"><span class="toc-number">1.1.2.</span> <span class="toc-text">Memcached(缓存)+MySQL+垂直拆分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分表分库-水平拆分-mysql集群"><span class="toc-number">1.1.3.</span> <span class="toc-text">分表分库+水平拆分+mysql集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSql特点"><span class="toc-number">1.2.</span> <span class="toc-text">NoSql特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSql数据库分类"><span class="toc-number">1.3.</span> <span class="toc-text">NoSql数据库分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分布式数据库CAP"><span class="toc-number">1.4.</span> <span class="toc-text">分布式数据库CAP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACID"><span class="toc-number">1.4.1.</span> <span class="toc-text">ACID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAP"><span class="toc-number">1.4.2.</span> <span class="toc-text">CAP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAP的三进二"><span class="toc-number">1.4.3.</span> <span class="toc-text">CAP的三进二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BASE"><span class="toc-number">1.4.4.</span> <span class="toc-text">BASE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis简介"><span class="toc-number">2.</span> <span class="toc-text">Redis简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis文档"><span class="toc-number">2.1.</span> <span class="toc-text">Redis文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-与其他-key-value-缓存产品有以下三个特点："><span class="toc-number">2.2.</span> <span class="toc-text">Redis 与其他 key - value 缓存产品有以下三个特点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">2.3.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xxxx"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">xxxx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis配置文件"><span class="toc-number">2.3.1.</span> <span class="toc-text">Redis配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基础命令"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">基础命令</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis数据类型"><span class="toc-number">3.</span> <span class="toc-text">Redis数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#键key"><span class="toc-number">3.1.</span> <span class="toc-text">键key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#String"><span class="toc-number">3.2.</span> <span class="toc-text">String</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hash"><span class="toc-number">3.3.</span> <span class="toc-text">Hash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#List"><span class="toc-number">3.4.</span> <span class="toc-text">List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set"><span class="toc-number">3.5.</span> <span class="toc-text">Set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#有序表Zset"><span class="toc-number">3.6.</span> <span class="toc-text">有序表Zset</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#命令"><span class="toc-number">4.</span> <span class="toc-text">命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置文件解析"><span class="toc-number">5.</span> <span class="toc-text">配置文件解析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内存处理策略"><span class="toc-number">6.</span> <span class="toc-text">内存处理策略</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis的持久化"><span class="toc-number">7.</span> <span class="toc-text">Redis的持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">7.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fork"><span class="toc-number">7.2.</span> <span class="toc-text">Fork</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB保存的是dump-rdb文件"><span class="toc-number">7.3.</span> <span class="toc-text">RDB保存的是dump.rdb文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB-（redis-database）"><span class="toc-number">7.4.</span> <span class="toc-text">RDB （redis database）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据恢复"><span class="toc-number">7.4.1.</span> <span class="toc-text">数据恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优势"><span class="toc-number">7.4.2.</span> <span class="toc-text">优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#劣势"><span class="toc-number">7.4.3.</span> <span class="toc-text">劣势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOF-（Append-Only-File）"><span class="toc-number">7.5.</span> <span class="toc-text">AOF （Append Only File）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">7.5.1.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#appendonly-yes-开启"><span class="toc-number">7.5.1.0.1.</span> <span class="toc-text">appendonly yes  开启</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#appendfsync-everysec"><span class="toc-number">7.5.1.0.2.</span> <span class="toc-text">appendfsync everysec</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#no-appendfsync-on-rewrite-no"><span class="toc-number">7.5.1.0.3.</span> <span class="toc-text">no-appendfsync-on-rewrite no</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#auto-aof-rewrite-percentage-100"><span class="toc-number">7.5.1.0.4.</span> <span class="toc-text">auto-aof-rewrite-percentage 100</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#auto-aof-rewrite-min-size-64mb"><span class="toc-number">7.5.1.0.5.</span> <span class="toc-text">auto-aof-rewrite-min-size 64mb</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修复"><span class="toc-number">7.5.2.</span> <span class="toc-text">修复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#正常恢复"><span class="toc-number">7.5.2.1.</span> <span class="toc-text">正常恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#异常"><span class="toc-number">7.5.2.2.</span> <span class="toc-text">异常</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rewrite"><span class="toc-number">7.5.3.</span> <span class="toc-text">Rewrite</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#重写原理"><span class="toc-number">7.5.3.1.</span> <span class="toc-text">重写原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#触发"><span class="toc-number">7.5.3.2.</span> <span class="toc-text">触发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#劣势-1"><span class="toc-number">7.5.4.</span> <span class="toc-text">劣势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何选择"><span class="toc-number">7.6.</span> <span class="toc-text">如何选择</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis事务"><span class="toc-number">8.</span> <span class="toc-text">Redis事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#demo"><span class="toc-number">8.0.1.</span> <span class="toc-text">demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#watch监控"><span class="toc-number">8.0.2.</span> <span class="toc-text">watch监控</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#悲观锁-Pessimistic-Lock"><span class="toc-number">8.0.2.1.</span> <span class="toc-text">悲观锁  Pessimistic Lock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#乐观锁"><span class="toc-number">8.0.2.2.</span> <span class="toc-text">乐观锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#demo-1"><span class="toc-number">8.0.2.3.</span> <span class="toc-text">demo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务三特性"><span class="toc-number">8.0.3.</span> <span class="toc-text">事务三特性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis的发布订阅"><span class="toc-number">9.</span> <span class="toc-text">Redis的发布订阅</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#主从复制-master-salve"><span class="toc-number">10.</span> <span class="toc-text">主从复制  master&#x2F;salve</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何操作"><span class="toc-number">10.1.</span> <span class="toc-text">如何操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#复制"><span class="toc-number">10.2.</span> <span class="toc-text">复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#哨兵模式"><span class="toc-number">10.3.</span> <span class="toc-text">哨兵模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点"><span class="toc-number">10.3.1.</span> <span class="toc-text">缺点</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210401142628.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Redis入门</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2021-03-27<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2021-07-14</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Redis/">Redis</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">5.7k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 19 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="NoSql？非关系型数据库"><a href="#NoSql？非关系型数据库" class="headerlink" title="NoSql？非关系型数据库"></a>NoSql？非关系型数据库</h2><h3 id="单机MySQL"><a href="#单机MySQL" class="headerlink" title="单机MySQL"></a>单机MySQL</h3><ul>
<li><p>数据量的总大小一个机器放不下时</p>
</li>
<li><p>数据的索引(B+ Tree)一个机器的内存放不下时</p>
</li>
<li><p>访问量(读写混合)一个实例不能承受</p>
</li>
</ul>
<h3 id="Memcached-缓存-MySQL-垂直拆分"><a href="#Memcached-缓存-MySQL-垂直拆分" class="headerlink" title="Memcached(缓存)+MySQL+垂直拆分"></a>Memcached(缓存)+MySQL+垂直拆分</h3><p>​        <code>由于数据库的写入压力增加，Memcached 只能缓解数据库的读取压力。读写集中在一个数据库上让数据库不堪重负，大部分网站开始使用主从复制技术来达到读写分离，以提高读写性能和读库的可扩展性。Mysql的master-slave模 式成为这个时候的网站标配了。</code></p>
<h3 id="分表分库-水平拆分-mysql集群"><a href="#分表分库-水平拆分-mysql集群" class="headerlink" title="分表分库+水平拆分+mysql集群"></a>分表分库+水平拆分+mysql集群</h3><p>​        <code>在Memcached的高速缓存，MySQL的主从复制， 读写分离的基础之上，这时MySQL主库的写压力开始出现瓶颈，而数据量的持续猛增，由于MyISAM使用表锁，在高并发下会出现严重的锁问题，大量的高并发MySQL应用开始使用InnoDB引擎代替MyISAM。</code></p>
<p><code>同时，开始流行使用分表分库来缓解写压力和数据增长的扩展问题。这个时候，分表分库成了一个热门技术，是面试的热门问题也是业界讨论的热门技术问题。也就在这个时候，MySQL推出了还不太稳定的表分区，这也给技术实力一般的公司带来了希望。虽然MySQL推出了MySQL Cluster集群，但性能也不能很好满足互联网的要求，只是在高可靠性上提供了非常大的保证。</code></p>
<ol>
<li>易扩展<br> NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展。也无形之间，在架构的层面上带来了可扩展的能力。</li>
<li>大数据量高性能<br> NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单。一般MySQL使用Query Cache，每次表的更新Cache就失效，是一种大粒度的Cache,在针对web2.0的交互频繁的应用，Cache性能不高。而NoSQL的Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说就要性能高很多了</li>
<li>多样灵活的数据模型<br> NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是一个噩梦</li>
</ol>
<h2 id="NoSql特点"><a href="#NoSql特点" class="headerlink" title="NoSql特点"></a>NoSql特点</h2><ul>
<li>代表着不仅仅是SQL</li>
<li>没有声明性查询语言</li>
<li>没有预定义的模式</li>
<li>键-值对存储，列存储，文档存储，图形数据库</li>
<li>最终一致性，而非ACID属性</li>
<li>非结构化和不可预知的数据:</li>
<li>CAP定理</li>
<li>高性能，高可用性和可伸缩性</li>
</ul>
<h2 id="NoSql数据库分类"><a href="#NoSql数据库分类" class="headerlink" title="NoSql数据库分类"></a>NoSql数据库分类</h2><p><a href="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210328163430.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="NoSql数据库的四大分类" class="fancybox"><img alt="NoSql数据库的四大分类" title="NoSql数据库的四大分类" data-src="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210328163430.png" src="https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/loading.gif" class="lazyload"></a></p>
<h2 id="分布式数据库CAP"><a href="#分布式数据库CAP" class="headerlink" title="分布式数据库CAP"></a>分布式数据库CAP</h2><h3 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h3><ol>
<li><p><code>A (Atomicity) 原子性 就是说事务里的所有操作要么全部做完，要么都不做，事务成功的条件是事务里的所有操作都成功，只要有一个操作失败，整个事务就失败，需要回滚。比如银行转账，从A账户转100元至B账户，分为两个步骤：1）从A账户取100元；2）存入100元至B账户。这两步要么一起完成，要么一起不完成，如果只完成第一步，第二步失败，钱会莫名其妙少了100元。</code></p>
</li>
<li><p><code>C (Consistency) 一致性 就是说数据库要一直处于一致的状态，事务的运行不会改变数据库原本的一致性约束。</code></p>
</li>
<li><p><code>I (Isolation) 独立性 所谓的独立性是指并发的事务之间不会互相影响，如果一个事务要访问的数据正在被另外一个事务修改，只要另外一个事务未提交，它所访问的数据就不受未提交事务的影响。比如现有有个交易是从A账户转100元至B账户，在这个交易还未完成的情况下，如果此时B查询自己的账户，是看不到新增加的100元的</code></p>
</li>
<li><p><code>D (Durability) 持久性 持久性是指一旦事务提交后，它所做的修改将会永久的保存在数据库上，即使出现宕机也不会丢失。</code></p>
</li>
</ol>
<h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3><ul>
<li>C:Consistency（强一致性）</li>
<li>A:Availability（可用性）</li>
<li>P:Partition tolerance（分区容错性）</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一致性（C）：在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）</span><br><span class="line">可用性（A）：保证每个请求不管成功或者失败都有响应。</span><br><span class="line">分区容忍性（P）：系统中任意信息的丢失或失败不会影响系统的继续运作。</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="CAP的三进二"><a href="#CAP的三进二" class="headerlink" title="CAP的三进二"></a>CAP的三进二</h3><p>一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，最多只能同时较好的满足两个</p>
<p><a href="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210328164352.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="" class="fancybox"><img alt="" title="" data-src="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210328164352.png" src="https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/loading.gif" class="lazyload"></a></p>
<ul>
<li><p>CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。</p>
</li>
<li><p>CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。</p>
</li>
<li><p>AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。</p>
</li>
</ul>
<hr>
<ul>
<li>一致性与可用性的决择</li>
</ul>
<ul>
<li>数据库事务一致性需求</li>
</ul>
<p><code>很多web实时系统并不要求严格的数据库事务，对读一致性的要求很低， 有些场合对写一致性要求并不高。允许实现最终一致性。</code></p>
<ul>
<li>数据库的写实时性和读实时性需求</li>
</ul>
<p><code>对关系数据库来说，插入一条数据之后立刻查询，是肯定可以读出来这条数据的，但是对于很多web应用来说，并不要求这么高的实时性，比方说在微博发一条消息之后，过几秒乃至十几秒之后，我的订阅者才看到这条动态是完全可以接受的。</code></p>
<ul>
<li>对复杂的SQL查询，特别是多表关联查询的需求<br><code>任何大数据量的web系统，都非常忌讳多个大表的关联查询，以及复杂的数据分析类型的报表查询，特别是SNS类型的网站，从需求以及产品设计角 度，就避免了这种情况的产生。往往更多的只是单表的主键查询，以及单表的简单条件分页查询，SQL的功能被极大的弱化了。</code></li>
</ul>
<h3 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h3><p><strong>BASE就是为了解决关系数据库强一致性引起的问题而引起的可用性降低而提出的解决方案。</strong></p>
<ul>
<li>基本可用（Basically Available）</li>
<li>软状态（Soft state）</li>
<li>最终一致（Eventually consistent）</li>
</ul>
<p>它的思想是通过<strong>让系统放松对某一时刻数据一致性的要求来换取系统整体伸缩性和性能上改观</strong>。为什么这么说呢，缘由就在于大型系统往往由于地域分布和极高性能的要求，不可能采用分布式事务来完成这些指标，要想获得这些指标，我们必须采用另外一种方式来完成，这里BASE就是解决这个问题的办法</p>
<h1 id="Redis简介"><a href="#Redis简介" class="headerlink" title="Redis简介"></a>Redis简介</h1><h2 id="Redis文档"><a href="#Redis文档" class="headerlink" title="Redis文档"></a>Redis文档</h2><h2 id="Redis-与其他-key-value-缓存产品有以下三个特点："><a href="#Redis-与其他-key-value-缓存产品有以下三个特点：" class="headerlink" title="Redis 与其他 key - value 缓存产品有以下三个特点："></a>Redis 与其他 key - value 缓存产品有以下三个特点：</h2><ul>
<li>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储</li>
<li>Redis支持数据的备份，即master-slave模式的数据备份</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h4 id="xxxx"><a href="#xxxx" class="headerlink" title="xxxx"></a>xxxx</h4><h3 id="Redis配置文件"><a href="#Redis配置文件" class="headerlink" title="Redis配置文件"></a>Redis配置文件</h3><p>默认6379  16库</p>
<h4 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h4><ul>
<li><code>SELECT</code>   切换库</li>
<li><code>DBSIZE</code>   当前库的key数量</li>
<li><code>FLUSHDB</code>  清空当前库</li>
<li><code>FLUSHALL</code>   清空全部库</li>
</ul>
<h1 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h1><h2 id="键key"><a href="#键key" class="headerlink" title="键key"></a>键key</h2><table>
<thead>
<tr>
<th>key *</th>
<th>所有key</th>
</tr>
</thead>
<tbody><tr>
<td>exists key</td>
<td>判断某个key是否存在</td>
</tr>
<tr>
<td>move key db</td>
<td>移动到某库</td>
</tr>
<tr>
<td>expire key seconds</td>
<td>设置过期时间</td>
</tr>
<tr>
<td>ttl key</td>
<td>查看key剩余过期时间，-1永不过期，2已经过期</td>
</tr>
<tr>
<td>type key</td>
<td>查看key类型</td>
</tr>
</tbody></table>
<p><a href="https://redis.io/commands#generic" target="_blank" rel="noopener">https://redis.io/commands#generic</a></p>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. string是redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。</span><br><span class="line"><span class="number">2</span>. string类型是二进制安全的。意思是redis的string可以包含任何数据。比如jpg图片或者序列化的对象 。</span><br><span class="line"><span class="number">3</span>. string类型是Redis最基本的数据类型，一个redis中字符串value最多可以是<span class="number">512</span>M</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. Redis hash 是一个键值对集合。</span><br><span class="line"><span class="number">2</span>. Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。</span><br><span class="line"><span class="number">3</span>. 类似Java里面的Map&lt;String,Object&gt;</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素导列表的头部（左边）或者尾部（右边）。</span><br><span class="line"><span class="number">2</span>. 它的底层实际是个链表</span><br></pre></td></tr></tbody></table></figure></div>

<p>链表的操作无论是头和尾效率都极高，但对中间元素进行操作，效率就惨淡了</p>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redis的Set是string类型的无序集合。它是通过HashTable实现实现的    差集、交集、并集</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="有序表Zset"><a href="#有序表Zset" class="headerlink" title="有序表Zset"></a>有序表Zset</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. Redis zset 和 set 一样也是string类型元素的集合，且不允许重复的成员。</span><br><span class="line"><span class="number">2</span>. 不同的是每个元素都会关联一个<span class="keyword">double</span>类型的分数。</span><br><span class="line"><span class="number">3</span>. redis正是通过分数来为集合中的成员进行从小到大的排序。zset的成员是唯一的，但分数(score)却可以重复。</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h1><p><a href="https://redis.io/commands#" target="_blank" rel="noopener">https://redis.io/commands#</a></p>
<h1 id="配置文件解析"><a href="#配置文件解析" class="headerlink" title="配置文件解析"></a>配置文件解析</h1><p><a href="https://blog.csdn.net/suprezheng/article/details/90679790" target="_blank" rel="noopener">https://blog.csdn.net/suprezheng/article/details/90679790</a></p>
<h1 id="内存处理策略"><a href="#内存处理策略" class="headerlink" title="内存处理策略"></a>内存处理策略</h1><p><code>#volatile-lru：利用LRU算法移除设置过过期时间的key。
#volatile-random：随机移除设置过过期时间的key。
#volatile-ttl：移除即将过期的key，根据最近过期时间来删除（辅以TTL）
#allkeys-lru：利用LRU算法移除任何key。
#allkeys-random：随机移除任何key。
#noeviction：不移除任何key，只是返回一个写错误。</code></p>
<h1 id="Redis的持久化"><a href="#Redis的持久化" class="headerlink" title="Redis的持久化"></a>Redis的持久化</h1><p><a href="https://redis.io/topics/persistence#redis-persistence" target="_blank" rel="noopener">https://redis.io/topics/persistence#redis-persistence</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Redis provides a different range of persistence options:</p>
<ul>
<li><strong>RDB</strong> (Redis Database): The RDB persistence performs point-in-time snapshots of your dataset at specified intervals.</li>
<li><strong>AOF</strong> (Append Only File): The AOF persistence logs every write operation received by the server, that will be played again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself, in an append-only fashion. Redis is able to rewrite the log in the background when it gets too big.</li>
<li><strong>No persistence</strong>: If you wish, you can disable persistence completely, if you want your data to just exist as long as the server is running.</li>
<li><strong>RDB + AOF</strong>: It is possible to combine both AOF and RDB in the same instance. Notice that, in this case, when Redis restarts the AOF file will be used to reconstruct the original dataset since it is guaranteed to be the most complete.</li>
</ul>
<p>The most important thing to understand is the different trade-offs between the RDB and AOF persistence. Let’s start with RDB:</p>
<p>​        <code>在指定时间间隔内将内存中的数据集快照写入磁盘，也就是Snapshot快照，它恢复时将快照文件直接读到内存</code></p>
<p>​        <code>Redis会单独创建一个（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，持久化过程都结束了，再用这个临时文件替换上次持久化好的文件，真个过程中，主进程是不尽兴任何IO操作的，这样就确保了极高的性能，如果徐涛进行大规模的数据恢复，且对数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。</code></p>
<h2 id="Fork"><a href="#Fork" class="headerlink" title="Fork"></a>Fork</h2><p>Fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等） 数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程</p>
<h2 id="RDB保存的是dump-rdb文件"><a href="#RDB保存的是dump-rdb文件" class="headerlink" title="RDB保存的是dump.rdb文件"></a>RDB保存的是dump.rdb文件</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Javascript</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">################################ SNAPSHOTTING  ################################</span><br><span class="line">#</span><br><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   In the example below the behavior will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all "save" lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save ""</span><br><span class="line"></span><br><span class="line">默认<span class="number">900</span>秒内有<span class="number">1</span>个更改，<span class="number">300</span>秒内有<span class="number">10</span>个更改以及<span class="number">60</span>秒内有<span class="number">10000</span>个更改，则将内存中的数据快照写入磁盘。</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="RDB-（redis-database）"><a href="#RDB-（redis-database）" class="headerlink" title="RDB （redis database）"></a>RDB （redis database）</h2><ul>
<li><p>配置文件中默认的快照配置dbfilename dump.rdb<br>冷拷贝后重新使用<br>cp dump.rdb dump_new.rdb</p>
</li>
<li><p>save或bgsave</p>
<ul>
<li>Save：save时只管保存，其它不管，全部阻塞</li>
<li>BGSAVE：Redis会在后台异步进行快照操作， 快照同时还可以响应客户端请求。可以通过lastsave 命令获取最后一次成功执行快照的时间</li>
</ul>
</li>
<li><p>执行flushall命令，也会产生dump.rdb文件，但里面是空的，无意义</p>
</li>
</ul>
<h3 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h3><p><strong>将备份文件  dump.rdb  移动至安装目录启动即可</strong></p>
<p>*<em>CONFIG GET dir  获取目录 *</em></p>
<p>停止    <code>redis-cli config set save ""</code></p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>适合大规模的数据恢复</li>
<li>对数据的完整性和一致性要求不搞</li>
</ul>
<h3 id="劣势"><a href="#劣势" class="headerlink" title="劣势"></a>劣势</h3><ul>
<li>在一定间隔时间做一次备份，redis意外宕机的话，就会丢失最后一次快照后的所有修改</li>
<li>Fork的时候，内存的数据被克隆了一份，大致两倍的膨胀性能需要考虑</li>
</ul>
<h2 id="AOF-（Append-Only-File）"><a href="#AOF-（Append-Only-File）" class="headerlink" title="AOF （Append Only File）"></a>AOF （Append Only File）</h2><p>The AOF persistence logs every write operation received by the server, that will be played again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself, in an append-only fashion. Redis is able to rewrite the log in the background when it gets too big.</p>
<p><strong>以日志的形式来记录每个写操作,</strong>将redis执行过的所有命令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，或者说，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><code># AOF and RDB persistence can be enabled at the same time without problems.</code></p>
<p><code># If the AOF is enabled on startup Redis will load the AOF, that is the file</code></p>
<p><code># with the better durability guarantees.</code></p>
<h5 id="appendonly-yes-开启"><a href="#appendonly-yes-开启" class="headerlink" title="appendonly yes  开启"></a><strong>appendonly yes</strong>  开启</h5><h5 id="appendfsync-everysec"><a href="#appendfsync-everysec" class="headerlink" title="appendfsync everysec"></a><strong>appendfsync everysec</strong></h5><p><code>Redis supports three different modes:</code></p>
<ul>
<li><p><code># no: don't fsync, just let the OS flush the data when it wants. Faster.</code></p>
</li>
<li><p><code># always: fsync after every write to the append only log. Slow, Safest.</code></p>
<p>同步持久化，每次发生数据变更会立即被记录到磁盘，性能较差，但数据完整性较好</p>
</li>
<li><p><code># everysec: fsync only one time every second. Compromise.</code></p>
<p>出场默认推荐，一步操作，每秒记录，如果一秒内宕机，有数据丢失</p>
</li>
</ul>
<h5 id="no-appendfsync-on-rewrite-no"><a href="#no-appendfsync-on-rewrite-no" class="headerlink" title="no-appendfsync-on-rewrite no"></a>no-appendfsync-on-rewrite no</h5><p>重写时是否可以运用appendfsync，用no即可，保证数据安全性和</p>
<h5 id="auto-aof-rewrite-percentage-100"><a href="#auto-aof-rewrite-percentage-100" class="headerlink" title="auto-aof-rewrite-percentage 100"></a>auto-aof-rewrite-percentage 100</h5><p>设置重写的基准值</p>
<h5 id="auto-aof-rewrite-min-size-64mb"><a href="#auto-aof-rewrite-min-size-64mb" class="headerlink" title="auto-aof-rewrite-min-size 64mb"></a>auto-aof-rewrite-min-size 64mb</h5><p>设置重写的基准值</p>
<h3 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h3><h4 id="正常恢复"><a href="#正常恢复" class="headerlink" title="正常恢复"></a>正常恢复</h4><p>aof保存到对应目录（CONFIG GET dir）启动即可</p>
<h4 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h4><p><strong>redis-check-aof –fix file</strong></p>
<h3 id="Rewrite"><a href="#Rewrite" class="headerlink" title="Rewrite"></a>Rewrite</h3><p>AOF采用文件追加方式，文件会越来越大，为了避免这种情况，新增了重写机制，当AOF文件的大小超过所设定的阈值时，Redis就会启动AOF文件的内容压缩，只保留可恢复数据的最小指令集，可以使用命令 <a href="https://redis.io/commands/bgrewriteaof" target="_blank" rel="noopener">BGREWRITEAOF</a></p>
<h4 id="重写原理"><a href="#重写原理" class="headerlink" title="重写原理"></a>重写原理</h4><p>AOF文件持续增长而过大时，会fork出一条新进程来将文件重写（同样是先写临时文件最后在rename），遍历新进程的内存中数据，每条记录都有一条的set语句。重写aof文件操作，并没有读取就得aof文件，而是将整个内存中的数据库内容用命令的方式重写了一个新的aof文件，和快照类似</p>
<h4 id="触发"><a href="#触发" class="headerlink" title="触发"></a>触发</h4><p>redis会记录上次重写时的aof大小，默认配置是当aof文件大小是上次rewrite后大小的一倍且文件大于64M时触发</p>
<p>auto-aof-rewrite-percentage 100<br>auto-aof-rewrite-min-size 64mb</p>
<h3 id="劣势-1"><a href="#劣势-1" class="headerlink" title="劣势"></a>劣势</h3><p>相同数据集的数据而言aof文件要远大于rdb文件，恢复速度慢于rdb</p>
<p>aof运行效率要慢于rdb，每秒同步策略较好，不同步效率和rdb相同</p>
<h2 id="如何选择"><a href="#如何选择" class="headerlink" title="如何选择"></a>如何选择</h2><p>RDB持久化方式能够在指定时间间隔内对数据进行快照存储</p>
<p>AOF持久化方式记录每次对服务器的写操作，当服务器重启的时候就会重新执行这些命令来恢复原始的数据，AOF命令以redis协议追加保存每次写的操作到文件末尾，redis还能对AOF文件进行后台重写，使得AOF文件的体积不止于过大</p>
<p>只做缓存，如果只希望数据在服务器运行时存在，可以不用任何持久化方式</p>
<p>同时开启两种持久化策略：</p>
<p><code>这种情况下，当redis重启的时候回优先载入AOF文件来恢复初始的数据，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集完整</code></p>
<p>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件那是否可以只是用AOF？</p>
<p><code>建议不要，因为RDB更适合用于备份数据库（AOF在不断变化不好备份，快速重启，而且不会有AOF可能潜在的bug，留着作为一个万一的手段</code></p>
<h1 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h1><p>所有命令都会被序列化，按顺序的串行化执行而不会被其他命令插入，不需加塞。</p>
<ul>
<li><a href="https://redis.io/commands/discard" target="_blank" rel="noopener">DISCARD</a></li>
<li><a href="https://redis.io/commands/exec" target="_blank" rel="noopener">EXEC</a></li>
<li><a href="https://redis.io/commands/multi" target="_blank" rel="noopener">MULTI</a></li>
<li><a href="https://redis.io/commands/unwatch" target="_blank" rel="noopener">UNWATCH</a></li>
<li><a href="https://redis.io/commands/watch" target="_blank" rel="noopener">WATCH</a></li>
</ul>
<p>redis对事务部分支持</p>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>demo1全体连坐  一个错误全部不执行</p>
<p>demo2 正确的执行 错误的抛出</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> demo1</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) "k1"</span><br><span class="line">2) "k2"</span><br><span class="line">3) "k3"</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 11</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 22</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k3</span><br><span class="line">(error) ERR wrong number of arguments for 'getset' command</span><br><span class="line">127.0.0.1:6379&gt; set k4 44</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br></pre></td></tr></tbody></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> demo2</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) "k1"</span><br><span class="line">2) "k2"</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">"aa"</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">"bb"</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 11</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 33</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an integer or out of range</span><br><span class="line">3) OK</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="watch监控"><a href="#watch监控" class="headerlink" title="watch监控"></a>watch监控</h3><h4 id="悲观锁-Pessimistic-Lock"><a href="#悲观锁-Pessimistic-Lock" class="headerlink" title="悲观锁  Pessimistic Lock"></a>悲观锁  Pessimistic Lock</h4><p>每次去拿数据的时候都认为别人会修改，所以每次拿数据的时候都会上锁，这样别人想拿这个数据机会block知道他拿到锁，传统的关系型数据库像行锁、表锁、读锁、写锁等都是在操作之前先上锁</p>
<h4 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h4><p>每次取数据的时候都认为比人不会修好，所以不会上锁，但是更新的时候回判断在此期间有没有人更新这个数据，可以使用版本号等机制</p>
<h4 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set balance 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set debt 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) "debt"</span><br><span class="line">2) "balance"</span><br><span class="line">127.0.0.1:6379&gt; get balance</span><br><span class="line">"100"</span><br><span class="line">127.0.0.1:6379&gt; WATCH balance</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY balance 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY debt 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) (integer) 80</span><br><span class="line">2) (integer) 20</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; WATCH balance</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 加塞  执行set balance 800</span></span></span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY balance 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY debt 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get balance</span><br><span class="line">"800"</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="事务三特性"><a href="#事务三特性" class="headerlink" title="事务三特性"></a>事务三特性</h3><ul>
<li>单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li>
<li>没有隔离级别的概念：队列中的命令没有提交之前都不会实际的被执行，因为事务提交前任何指令都不会被实际执行， 也就不存在”事务内的查询要看到事务里的更新，在事务外查询不能看到”这个让人万分头痛的问题</li>
<li>不保证原子性：redis同一个事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚</li>
</ul>
<h1 id="Redis的发布订阅"><a href="#Redis的发布订阅" class="headerlink" title="Redis的发布订阅"></a>Redis的发布订阅</h1><p>rabbitmq</p>
<h1 id="主从复制-master-salve"><a href="#主从复制-master-salve" class="headerlink" title="主从复制  master/salve"></a>主从复制  master/salve</h1><ul>
<li>读写分离</li>
<li>容灾恢复</li>
</ul>
<h2 id="如何操作"><a href="#如何操作" class="headerlink" title="如何操作"></a>如何操作</h2><ol>
<li><p>配从库不配主库</p>
</li>
<li><p>从库配置：<strong>slaveof 主库ip 主库端口</strong></p>
<ul>
<li>每次master断开之后，都需要重新连接，除非你配置进redis.conf  <strong>REPLICATION</strong></li>
<li>INFO replication 当前角色</li>
<li>对于主机设置密码  配置文件中 masterauth password</li>
</ul>
</li>
<li><p>常用模式</p>
<ul>
<li><p>一主二仆</p>
<p><code>主机shutdown之后，从机原地待命；主机又开启之后，主机新增记录，从机可以顺利复制</code></p>
<p><code>从机shutdown之后，无法获得主机数据，每次与master断开连接后，都需要重新连接，除非配置进redis.conf文件</code></p>
</li>
<li><p>薪火相传</p>
<p>链式传递</p>
</li>
<li><p>反客为主</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof no one</span><br></pre></td></tr></tbody></table></figure></div>

<p>是当前的数据库停止与其他数据库的同步，转为主数据库</p>
</li>
</ul>
</li>
</ol>
<h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><ul>
<li>slave启动成功连接到master后会发送一个sync命令<br>master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步</li>
<li>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</li>
<li>增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li>
<li>但是只要是重新连接master，一次完全同步（全量复制)将被自动执行</li>
</ul>
<h2 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h2><p><strong>能够从后台监控机器是否故障，如果故障了根据投票数自动将从库转换为主库</strong></p>
<p>新建sentinel.conf</p>
<p><strong>sentinel monitor host6379 127.0.0.1 6379 1</strong> </p>
<p><strong>sentinel auth-pass host6379 123456</strong>    //主机密码</p>
<p>最后一个数字1 表示，主机挂掉以后，slave投票看让谁接替成为主机</p>
<p>哨兵开启</p>
<p><strong>redis-sentinel /user/local/redis/bin/sentinel.conf</strong></p>
<p>当主机挂掉后，从库成为master，当旧主机重启后，会改变身份，成为slave</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>由于所有的写操作都在master上操作，然后同步更新到slave上，所以从master同步到slave机器有一定延迟，当系统很繁忙的时候，延迟问题会更加严重，slave机器数量的增加也会是这个问题更加严重。</p>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">陳 ？</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://raptor1998.top/2021/03/27/redis/">http://raptor1998.top/2021/03/27/redis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://raptor1998.top">raptor's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210401142628.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/2222.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/raptor1998/imghouse/JavaEE/zhifubao.png" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/04/06/mysql%E4%BC%98%E5%8C%96/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210401142646.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>MySQL优化</span></div></a></div><div class="next-post pull_right"><a href="/2021/03/10/mybatis/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210327191915.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/raptor1998/imghouse/raptor1998_img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>mybatis</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/07/14/redis分布式锁/" title="Redis分布式锁"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210401142628.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-08-03</div><div class="relatedPosts_title">Redis分布式锁</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC80ODEyMS8yNDYxOA=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/Raptor1998/imghouse/untidy/20210401142628.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 陳 ？</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">show me the code</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script src="https://cdn.jsdelivr.net/npm/activate-power-mode/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true; 
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/ClickShowText.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>